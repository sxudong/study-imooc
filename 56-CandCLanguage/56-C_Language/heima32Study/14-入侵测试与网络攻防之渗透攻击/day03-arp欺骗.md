# day3- ARP攻击

## ARP协议

ARP协议通过IP地址来查找主机的物理地址（也就是MAC地址）。

**局域网内部，A机，到B机发包过程:**

A做connect时，给的时B->ip地址，(补充，HUB链接，包广播，如果交换机连接，交换机基于mac地址多包转发），在局域网内，依赖mac地址发包。此时:(第一次发包时)

- 主机A，发ARP协议包，目标mac为全FF，广播包," ip为B->ip的主机,mac地址是多少”
- 主机B，答复A,“ip为B->ip的mac地址为B->mac"
- 主机A，收到B->mac地址，发包时，内核(系统、协议栈)填入B->mac地址，开始发送syn(数据包)包......



补充：如果，A机，连接时，连接 www.baidu.com :

- 此时，发送ARP广播包时，“目标P的mac'是多少”，网关应答，
- 潜在的意思是，A发送数据包，目标IP为百度，目标MAC为网关的mac地址。



## ARP缓存

arp-a
了解了arp缓存后，发包发包的顺序就简单加一个“0“步骤
先看，arp缓存表中，有无目标ip的mac地址，有的话，就直接利用就好了，没有的话，发arp广播包就好了。



**Tips：算是有缓存的地方，就可以搞点事。**



**问题：假如说，你缓存的B主机mac地址，其实是C主机的mac地址，这个情况下，你的包发到哪里去了？**



## ARP欺骗原理

构造一个包，模拟arp应答包，告知发arp广播包的主机，ip为（广播包的目的IE),mac为是"当前主机"。

(本质上，就是用你希望的mac，更新目标主机的arp缓存)



## 攻击实战

- 192.168.26.30：当作源主机，开启wireshark，抓从192.168.26.32发过来的ping
- 192.168.26.32：执行ping命令，`ping 192.168.26.30`
- 192.168.26.240：执行欺骗，目标能获取32主机发出包，
  - 开启，wireshark，以抓到32的ping为成功标志

```
itcast@~$ sudo arpspoof -i eth0 -t 192.168.26.32 192.168.26.30
```



## ARP欺骗的应用场景

1.只限于局域网内部。

2.通常欺骗的目标主机，冒充网关。

3.配合嗅探工具。



防护手段介绍:

1. 绑定mac地址和ip地址。

2. 一般在网关的地方，进行IP+MAC地址绑定。



